<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Ibatis" xmlns="http://ibatis.apache.org/mapping"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--创建类的别名-->
  <alias>
    <typeAlias alias="User" type="TongManage.Models.User, TongManage" />
  </alias>

  <resultMaps>
    <!--User类与db表的映射-->
    <resultMap id="User" class="User">
      <result property="Id" column="Id"/>
      <result property="Name" column="Name"/>
      <result property="UserPhoto" column="User_Photo"/>
      <result property="RoleId" column="Role_Id"/>
      <result property="Password" column="Password"/>
      <result property="GmtCreate" column="Gmt_Create" />
      <result property="GmtModified" column="Gmt_Modified"  />
      <result property="IsDeleted" column="Is_Deleted" />
    </resultMap>
  </resultMaps>

  <statements>

    <!--查询所有记录-->
    <select id="SelectAllUsers" resultMap="User">
      SELECT * from fixture_user
      WHERE is_deleted = 0
    </select>

    <!--查询单条记录-->
    <select id="SelectUserById" parameterClass="int" resultMap="User" >
      SELECT * from fixture_user
      WHERE id = #value# AND is_deleted = 0
    </select>

    <!--查询单条记录通过用户名-->
    <select id="SelectUserByUserName" parameterClass="string" resultMap="User" >
      SELECT * from fixture_user
      WHERE Name = #value# AND is_deleted = 0
    </select>

    <!--插入新记录-->
    <insert id="InsertUser" parameterClass="User">
      INSERT into fixture_user ( Name, User_Photo, Role_Id, Password, Gmt_Create, Gmt_Modified, Is_Deleted)
      values ( #Name#, #UserPhoto#, #RoleId#, #Password#, #GmtCreate#, #GmtModified#, #IsDeleted#)
      <selectKey resultClass="int" type="post" property="id" >
        select LAST_INSERT_ID() as value
      </selectKey>
    </insert>

    <!--更新单条记录-->
    <update id="UpdateUser" parameterClass="User">
      UPDATE fixture_user SET
      Name = #Name#,
      User_Photo = #UserPhoto#,
      Role_Id = #RoleId#,
      Password = #Password#,
      Gmt_Create = #GmtCreate#,
      Gmt_Modified = #GmtModified#,
      WHERE id = #Id# AND is_deleted = 0
    </update>

    <!--根据主键删除单条记录-->
    <update id="DeleteUserById" parameterClass="int">
      UPDATE fixture_user
      SET Is_Deleted = 1
      WHERE id = #value#
    </update>

  </statements>

</sqlMap>

